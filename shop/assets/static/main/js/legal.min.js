/**
 * Battle.net Legal
 *
 * @copyright       Â©2013 Blizzard Entertainment, Inc. All rights reserved.
 */
'use strict';
var AgeGateInterceptor={config:{},form:$("#agegate-form"),submitButton:$("#agegate-submit"),yearSelect:$("#agegate-year"),monthSelect:$("#agegate-month"),daySelect:$("#agegate-day"),create:function(a){this._construct(a);return this;},_construct:function(a){if(!this.form.length){return;}a=typeof a==="undefined"?{}:a;this.config=$.extend({},a);this.setup();},setup:function(){this.registerEvents();},registerEvents:function(){$(window).on("pageshow.agegate",$.proxy(this._onPageShow,this));this.form.on("submit.agegate",$.proxy(this._onFormSubmit,this));this.form.on("change.agegate","select",$.proxy(this._onChangeSelect,this));},_onPageShow:function(a){if(a&&a.originalEvent&&a.originalEvent.persisted){this.resetForm();}},_onFormSubmit:function(){var a=this.form;this.submitButton.button("loading");return true;},_onChangeSelect:function(){if(this.yearSelect.val()===""||this.monthSelect.val()===""||this.daySelect.val()===""){this.disableSubmitButton();}else{this.enableSubmitButton();}},disableSubmitButton:function(){this.submitButton.prop("disabled",true).attr("disabled","disabled").addClass("disabled");},enableSubmitButton:function(){this.submitButton.button("reset");},resetForm:function(){this.yearSelect.find('[value=""]').trigger("click");this.monthSelect.find('[value=""]').trigger("click");this.daySelect.find('[value=""]').trigger("click");this.disableSubmitButton();}};var AgeGateUi={config:{},url:"/age-gate-async/",pagePrefix:"",form:$("#agegate-form"),submitButton:$("#agegate-submit"),unknown:$("#agegate-unknown"),failure:$("#agegate-failure"),yearSelect:$("#agegate-year"),monthSelect:$("#agegate-month"),daySelect:$("#agegate-day"),legalId:$("#agegate-legalId"),create:function(a){this._construct(a);return this;},_construct:function(a){if(!this.form.length){return;}a=typeof a==="undefined"?{}:a;this.config=$.extend({url:"",pagePrefix:""},a);this.setup();},setup:function(){var a=this.config;if(a.url!==""){this.url=a.url;}if(a.pagePrefix!==""){this.pagePrefix=a.pagePrefix;}else{this.pagePrefix=Msg.analytics.pagePrefix;}this.registerEvents();},registerEvents:function(){$(window).on("pageshow.agegate",$.proxy(this._onPageShow,this));this.form.on("submit.agegate",$.proxy(this._onFormSubmit,this));this.form.on("change.agegate","select",$.proxy(this._onChangeSelect,this));this.form.on("hidden.agegate",$.proxy(this._onModalHidden,this));this.form.on("show.agegate",$.proxy(this._onModalShow,this));this.form.on("verify.agegate",$.proxy(this._onVerify,this));},_onPageShow:function(a){if(a&&a.originalEvent&&a.originalEvent.persisted){this.resetForm();}},_onFormSubmit:function(){var c=this.form,a=this.unknown,e=this.failure,b=this.url,j=this.pagePrefix,g=this.yearSelect.val(),f=this.monthSelect.val(),i=this.daySelect.val(),d=this.legalId.val(),h=Core.region||"";this.submitButton.button("loading");$.ajax({url:b,type:"post",dataType:"json",context:this,data:{year:g,month:f,day:i,legalId:d}}).done(function(l){if(typeof _gaq!=="undefined"||typeof ga!=="undefined"){var k="Age Gate";if(j!==""){k=j+" "+k;}if(typeof _gaq!=="undefined"){_gaq.push(["_trackEvent",k,"Submit",l+" - "+h]);}if(typeof ga!=="undefined"){ga("bnetgtm.send","event",{eventCategory:k,eventAction:"Submit",eventLabel:l+" - "+h});}}this.setStatus(l);this.submitButton.button("reset");c.trigger("done.agegate",[l]);}).fail(function(){c.trigger("fail.agegate");});return false;},_onChangeSelect:function(){if(this.yearSelect.val()===""||this.monthSelect.val()===""||this.daySelect.val()===""){this.disableSubmitButton();}else{this.enableSubmitButton();}},_onModalHidden:function(){this.resetForm();},_onModalShow:function(){this.resetForm();},_onVerify:function(){var b=this.form,a=this.url;$.ajax({url:a,type:"get",dataType:"json",context:this,}).done(function(c){this.setStatus(c);b.trigger("done.agegate",[c]);}).fail(function(){b.trigger("fail.agegate");});return false;},disableSubmitButton:function(){this.submitButton.prop("disabled",true).attr("disabled","disabled").addClass("disabled");},enableSubmitButton:function(){this.submitButton.button("reset");},resetForm:function(){this.yearSelect.find('[value=""]').trigger("click");this.monthSelect.find('[value=""]').trigger("click");this.daySelect.find('[value=""]').trigger("click");this.disableSubmitButton();},setStatus:function(a){if(a==="FAILED"){this.form.addClass("agegate-failed");this.unknown.addClass("hide");this.failure.removeClass("hide");}if(a==="UNKNOWN"){this.form.removeClass("agegate-failed");this.unknown.removeClass("hide");this.failure.addClass("hide");}}};